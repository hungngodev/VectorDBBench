#!/usr/bin/env bash

NS=${NS:-marco}
IMG=${IMG:-hungngodev/vectordbbench:latest}

DATA_DIR=${DATA_DIR:-/opt/vdb/datasets}
HOST_DATA_DIR=${HOST_DATA_DIR:-/mnt/nfs/home/hmngo/work1/hmngo/datasets}
HOST_RESULTS_DIR=${HOST_RESULTS_DIR:-/mnt/nfs/home/hmngo/work1/hmngo/vdb_results}
RESULT_ROOT=${RESULT_ROOT:-/mnt/nfs/home/hmngo/work1/hmngo/vdb_results}

CASE_TYPE=${CASE_TYPE:-Performance768D100K}
NUM_CONCURRENCY=${NUM_CONCURRENCY:-32}
CONCURRENCY_DURATION=${CONCURRENCY_DURATION:-30}
EF_CONSTRUCTION=${EF_CONSTRUCTION:-360}
REPLICA=${REPLICA:-1}
SHARDING=${SHARDING:-1}
K=${K:-10}

HNSW_M_VALUES=${HNSW_M_VALUES:-"4 8 16 32 64 128 256"}
HNSW_EF_VALUES=${HNSW_EF_VALUES:-"128 192 256 384 512 640 768 1024"}

CPU=${CPU:-16}
MEM=${MEM:-128Gi}
PROTOBUF_VERSION=${PROTOBUF_VERSION:-6.31.1}

ENABLE_MILVUS=${ENABLE_MILVUS:-true}
ENABLE_WEAVIATE=${ENABLE_WEAVIATE:-true}
ENABLE_QDRANT=${ENABLE_QDRANT:-false}
ENABLE_VALD=${ENABLE_VALD:-false}

DROP_OLD_QDRANT=${DROP_OLD_QDRANT:-true}
VALD_WAIT_SECONDS=${VALD_WAIT_SECONDS:-60}
VALD_TIMEOUT=${VALD_TIMEOUT:-300}
VALD_CONCURRENCIES=${VALD_CONCURRENCIES:-"1"}

M_ARR=(${HNSW_M_VALUES})
EF_ARR=(${HNSW_EF_VALUES})
M_RANGE="${M_ARR[0]}to${M_ARR[-1]}"
EF_RANGE="${EF_ARR[0]}to${EF_ARR[-1]}"

TIMESTAMP=$(date +%Y%m%d-%H%M)
BATCH_ID=${BATCH_ID:-"${CASE_TYPE}_Conc${NUM_CONCURRENCY}_EFC${EF_CONSTRUCTION}_Rep${REPLICA}_Shard${SHARDING}_K${K}_M${M_RANGE}_EF${EF_RANGE}_${TIMESTAMP}"}

export NS IMG DATA_DIR HOST_DATA_DIR HOST_RESULTS_DIR RESULT_ROOT
export CASE_TYPE NUM_CONCURRENCY CONCURRENCY_DURATION EF_CONSTRUCTION REPLICA SHARDING K
export HNSW_M_VALUES HNSW_EF_VALUES CPU MEM PROTOBUF_VERSION
export ENABLE_MILVUS ENABLE_WEAVIATE ENABLE_QDRANT ENABLE_VALD
export DROP_OLD_QDRANT VALD_WAIT_SECONDS VALD_TIMEOUT VALD_CONCURRENCIES
export BATCH_ID
